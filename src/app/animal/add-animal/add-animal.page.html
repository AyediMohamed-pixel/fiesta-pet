<div style="overflow: auto;">
  <!-- Page Header -->
  <header class="page-header">
    <h1>Ajouter un Animal</h1>
  </header>

  <!-- Main Content -->
  <main class="main-content">
    <div class="container">

      <form class="pet-form">
        <!-- Animal Type Selection -->
        <div class="form-section">
          <h3>S√©lectionnez le type d'animal</h3>
          <div class="animal-type-grid" *ngIf="!loadingAnimalTypes; else loadingTemplate">
            <button type="button" class="animal-btn" *ngFor="let animalType of animalTypes; trackBy: trackByIndex"
              [class.selected]="selectedAnimalTypeId === animalType.id" (click)="selectAnimal(animalType)"
              [attr.data-type]="animalType.label.toLowerCase()">
              <div class="animal-icon">
                <img [src]="'assets/img/' + animalType.label.toLowerCase() + '.svg'" [alt]="animalType.label">
              </div>
              <span>{{ animalType.label }}</span>
            </button>
          </div>
          <ng-template #loadingTemplate>
            <div class="loading-state">
              <div class="loading-spinner"></div>
              <p>Chargement des types d'animaux...</p>
            </div>
          </ng-template>
        </div>

        <!-- Form Fields -->
        <div class="form-group">
          <label for="petName">Nom de l'Animal</label>
          <input type="text" id="petName" name="petName" placeholder="Ex: Bella, Max, Luna..." [(ngModel)]="petName"
            required>
        </div>

        <div class="form-group">
          <label for="ownerName">Nom du Propri√©taire</label>
          <input type="text" id="ownerName" name="ownerName" placeholder="Votre nom complet" [(ngModel)]="ownerName"
            required>
        </div>

        <div class="form-group">
          <label>Num√©ro(s) de T√©l√©phone</label>
          <div class="phone-container">
            <div class="phone-input-group" *ngFor="let phone of phoneNumbers; let i = index; trackBy: trackByIndex">
              <input type="tel" placeholder="Num√©ro de t√©l√©phone" [(ngModel)]="phoneNumbers[i]" [name]="'phone' + i"
                required>
              <button type="button" class="btn-add-phone" (click)="addPhoneField()"
                *ngIf="i === phoneNumbers.length - 1">
                +
              </button>
              <button type="button" class="btn-remove-phone" (click)="removePhoneField(i)"
                *ngIf="phoneNumbers.length > 1">
                √ó
              </button>
            </div>
          </div>
        </div>



        <div class="form-group">
          <label for="notes">Notes Suppl√©mentaires (optionnel)</label>
          <textarea id="notes" name="notes" rows="3" placeholder="Informations sp√©ciales, allergies, comportement..."
            [(ngModel)]="notes">
        </textarea>
        </div>

        <!-- Action Buttons -->
        <div class="form-actions">
          <button type="button" class="btn btn-primary btn-block" (click)="generateQR()"
            [disabled]="!isFormValid() || isSaving || loadingAnimalTypes">
            <span *ngIf="!isSaving">Cr√©er le Profil & G√©n√©rer QR</span>
            <span *ngIf="isSaving">Cr√©ation en cours...</span>
          </button>
          <a routerLink="/animal" class="btn btn-outline btn-block">
            Retour √† la liste
          </a>
        </div>
      </form>

      <!-- QR Result Section -->
      <div class="qr-result" *ngIf="showQRResult">
        <div class="card">
          <div class="card-header">
            <h3>Profil Cr√©√© avec Succ√®s!</h3>
          </div>
          <div class="card-content">
            <div class="qr-container">
              <div class="qr-code">
                <img [src]="qrCodeDataURL" alt="QR Code" class="qr-image" *ngIf="qrCodeDataURL">
                <div class="qr-placeholder" *ngIf="!qrCodeDataURL">üì± QR Code</div>
              </div>
            </div>
            <p>Votre code QR est pr√™t! Scannez-le pour acc√©der instantan√©ment aux informations de {{ petName }}.</p>

            <div class="qr-info" *ngIf="animalId">
              <p>Lien g√©n√©r√©:</p>
              <div class="qr-link">{{ pathUrl }}animal/detail-animal/{{ animalId }}</div>
              <p class="qr-note">Ce lien m√®ne directement √† la page de d√©tail de {{ petName }}.</p>
            </div>

            <div class="qr-actions">
              <button class="btn btn-success btn-block" (click)="downloadQRCode()">
                T√©l√©charger QR Code
              </button>
              <button class="btn btn-outline btn-block" (click)="resetForm()">
                Cr√©er un Autre Profil
              </button>
            </div>
          </div>
        </div>
      </div>
    </div>
  </main>

  <!-- Toast Notifications -->
  <div class="toast-container" *ngIf="showToast">
    <div class="toast" [class]="'toast-' + toastColor">
      {{ toastMessage }}
    </div>
  </div>

</div>